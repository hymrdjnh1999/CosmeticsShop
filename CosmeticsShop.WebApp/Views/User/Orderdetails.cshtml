@model List<Cosmetics.ViewModels.Catalogs.Orders.ClientOrderHistoryViewMode>;
@using CosmeticsShop.Data.Enums;

@{
    ViewData["Title"] = "Orderdetails";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="main">
    <div id="pageContainer">
        <main class="main_content" role="main">
            <div class="d-none rounded fixed-top justify-content-center" id="cancelMsgWrap">
                <span id="cancelMsg" class="rounded"></span>
            </div>
            <section id="page-wapper">
                <div class="wrapperAccount">
                    <div class="inner">
                        <div class="grid mg-left-110">
                            <div class="grid__item one-whole pd-left110">
                                <h2>Xin chào, @ViewBag.Name</h2>
                            </div>
                            <div class="grid__item one-quarter pd-left110">
                                <ul class="no-bullets">
                                    <li><a href="/user/detail">Thông tin tài khoản</a></li>
                                    <li><a href="#">Lịch sử đơn hàng</a></li>
                                </ul>
                            </div>
                            <div class="grid__item three-quarters pd-left110 br-right">
                                <div class="table-wrap table-order-customer bqOhOA">
                                    <div class="heading">
                                        <span>Chi tiết đơn hàng #1</span>
                                        <span class="split">-</span>
                                        <span class="status">Đang Giao Hàng</span>
                                    </div>
                                    <div class="created-date">
                                        "Ngày đặt hàng: "
                                        "22:09 07/07/2021"
                                    </div>
                                    <div class="addressUser">
                                        <div class="addressNav">
                                            <div class="title">
                                                Địa chỉ người nhận
                                            </div>
                                            <div class="content">
                                                <p class="name">name</p>
                                                <p class="address"><span>Địa chỉ: </span> địa chỉ</p>
                                                <p class="phone"><span>Điện thoại: </span> Số điện thoại</p>
                                            </div>
                                        </div>
                                        <table class="table-details">
                                            <thead>
                                                <tr>
                                                    <th>Sản phẩm</th>
                                                    <th>Giá</th>
                                                    <th>Số lượng</th>
                                                    <th class="text-center">Thuế </br><span style="font-size: 14px; color: #000000; font-weight: 400; text-transform: none;">(đã tính trong sản phẩm)</span></th>
                                                    <th>Tạm tính</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <div class="product-item">
                                                            <img src="//cdn.shopify.com/s/files/1/0003/8718/6741/products/100ml_fe295558-3b3a-44cd-b2ab-7700abf18f51_250x.jpg?v=1624440789" alt="ảnh sản phẩm" />
                                                            <div class="product-info">
                                                                <a class="product-name" href="#">tên sản phẩm này rất là dài rất rất là dài</a>
                                                                <p class="code-orders">"Mã đơn hàng: " "#1"</p>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="price">10.000.000 ₫</td>
                                                    <td class="quantity">1</td>
                                                    <td class="vat">100.000 ₫</td>
                                                    <td class="raw-total">10.000.000 ₫</td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="4"><span>Tạm tính</span></td>
                                                    <td>10.000.000 ₫</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4"><span>Thuế</span></td>
                                                    <td>100.000 ₫</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4"><span>Tổng cộng</span></td>
                                                    <td> <span class="sum">10.000.000 ₫</span></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                        <a class="view-list-order" href="/user/OrderHistory"><< Quay lại đơn hàng của tôi</a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>

@section Scripts{
    <script>
        const onSubmitCancelOrder = (btnElement) => {
            const cancelReason = document.querySelector('#orderCancelReason').value;
            if (!cancelReason.trim()) {
                document.querySelector('#cancelOrderReason').innerText = "Không được để trống lý do";
                event.preventDefault();
                return;
            }
            const orderId = btnElement.getAttribute('data');
            if (orderId) {
                $.ajax({
                    method: 'PUT',
                    url: `/user/cancelOrder`,
                    dataType: 'text',
                    data: { orderId: Number(orderId), cancelReason },
                    async: true,
                    success: async function (response) {

                        const { isSuccess, message } = JSON.parse(response);

                        $('#cancelMsgWrap').removeClass('d-none').addClass('d-flex');
                        if (isSuccess) {
                            $('#cancelMsg').html(message).addClass('rounded alert alert-success')
                        }
                        else {
                            $('#cancelMsg').html(message).addClass('rounded alert alert-danger')
                        }
                        await new Promise((resolve) => setTimeout(() => {
                            $('#cancelMsgWrap').fadeOut('slow');
                            resolve();
                        }, 1500));
                        $('#cancelMsg').html('')
                        $('#cancelMsgWrap').removeClass('d-flex').addClass('d-none');
                        handleOnCancel();
                        location.reload();
                    },
                    failure: function (response) {
                        alert('false')
                    },
                    error: function (response) {
                        alert('error')
                    }
                })
            }
        }
    </script>
}